<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan Results - WebVulnScan</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="static/js/script.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-shield-alt"></i> WebVulnScan</h1>
            <p>Web Application Vulnerability Scanner</p>
        </header>
        
        <main>
            <div class="results-header">
                <h2>Scan Results</h2>
                <div class="results-actions">
                    <a href="{{ url_for('index') }}" class="btn"><i class="fas fa-arrow-left"></i> New Scan</a>
                    {% if results.info.report_url %}
                    <a href="{{ results.info.report_url }}" class="btn primary" download><i class="fas fa-file-pdf"></i> Download PDF Report</a>
                    {% endif %}
                </div>
            </div>
            
            <div class="scan-summary card">
                <h3>Scan Summary</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="label">Target URL:</span>
                        <span class="value">{{ results.info.target_url }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Start Time:</span>
                        <span class="value">{{ results.info.start_time }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">End Time:</span>
                        <span class="value">{{ results.info.end_time }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Duration:</span>
                        <span class="value">{{ results.info.scan_duration }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">URLs Scanned:</span>
                        <span class="value">{{ results.info.scanned_urls }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Forms Tested:</span>
                        <span class="value">{{ results.info.forms_tested }}</span>
                    </div>
                </div>
            </div>
            
            <div class="vulnerability-summary card">
                <h3>Vulnerability Summary</h3>
                <div class="vuln-stats">
                    <div class="vuln-stat {% if results.sql_injection %}critical{% endif %}">
                        <div class="vuln-count">{{ results.sql_injection|length }}</div>
                        <div class="vuln-type">SQL Injection</div>
                    </div>
                    <div class="vuln-stat {% if results.xss %}critical{% endif %}">
                        <div class="vuln-count">{{ results.xss|length }}</div>
                        <div class="vuln-type">XSS</div>
                    </div>
                    <div class="vuln-stat {% if results.open_redirect %}high{% endif %}">
                        <div class="vuln-count">{{ results.open_redirect|length }}</div>
                        <div class="vuln-type">Open Redirect</div>
                    </div>
                    <div class="vuln-stat {% if results.missing_headers %}medium{% endif %}">
                        <div class="vuln-count">{{ results.missing_headers|length }}</div>
                        <div class="vuln-type">Missing Headers</div>
                    </div>
                </div>
            </div>
            
            <!-- SQL Injection Findings -->
            {% if results.sql_injection %}
            <div class="findings-section card">
                <h3><i class="fas fa-database"></i> SQL Injection Vulnerabilities</h3>
                <div class="severity-indicator critical">Critical</div>
                
                {% for vuln in results.sql_injection %}
                <div class="finding-item">
                    <h4>Finding #{{ loop.index }}</h4>
                    <div class="finding-details">
                        <div class="detail-row">
                            <span class="detail-label">URL:</span>
                            <span class="detail-value">{{ vuln.url }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Method:</span>
                            <span class="detail-value">{{ vuln.method|upper }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Vulnerable Field:</span>
                            <span class="detail-value">{{ vuln.field }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Payload:</span>
                            <span class="detail-value code">{{ vuln.payload }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Error:</span>
                            <span class="detail-value">{{ vuln.error }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                <div class="recommendation">
                    <h4>Recommendations:</h4>
                    <ul>
                        <li>Use parameterized queries or prepared statements</li>
                        <li>Implement input validation and sanitization</li>
                        <li>Use an ORM (Object-Relational Mapping) library</li>
                        <li>Apply the principle of least privilege for database users</li>
                    </ul>
                </div>
            </div>
            {% endif %}
            
            <!-- XSS Findings -->
            {% if results.xss %}
            <div class="findings-section card">
                <h3><i class="fas fa-code"></i> Cross-Site Scripting (XSS) Vulnerabilities</h3>
                <div class="severity-indicator critical">Critical</div>
                
                {% for vuln in results.xss %}
                <div class="finding-item">
                    <h4>Finding #{{ loop.index }}</h4>
                    <div class="finding-details">
                        <div class="detail-row">
                            <span class="detail-label">URL:</span>
                            <span class="detail-value">{{ vuln.url }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Method:</span>
                            <span class="detail-value">{{ vuln.method|upper }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Vulnerable Field:</span>
                            <span class="detail-value">{{ vuln.field }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Payload:</span>
                            <span class="detail-value code">{{ vuln.payload }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                <div class="recommendation">
                    <h4>Recommendations:</h4>
                    <ul>
                        <li>Implement Content Security Policy (CSP)</li>
                        <li>Use context-specific output encoding</li>
                        <li>Sanitize user input</li>
                        <li>Use modern frameworks that automatically escape output</li>
                        <li>Implement the X-XSS-Protection header</li>
                    </ul>
                </div>
            </div>
            {% endif %}
            
            <!-- Open Redirect Findings -->
            {% if results.open_redirect %}
            <div class="findings-section card">
                <h3><i class="fas fa-external-link-alt"></i> Open Redirect Vulnerabilities</h3>
                <div class="severity-indicator high">High</div>
                
                {% for vuln in results.open_redirect %}
                <div class="finding-item">
                    <h4>Finding #{{ loop.index }}</h4>
                    <div class="finding-details">
                        <div class="detail-row">
                            <span class="detail-label">URL:</span>
                            <span class="detail-value">{{ vuln.url }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Parameter:</span>
                            <span class="detail-value">{{ vuln.parameter }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Payload:</span>
                            <span class="detail-value code">{{ vuln.payload }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Redirect URL:</span>
                            <span class="detail-value">{{ vuln.redirect_url }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                <div class="recommendation">
                    <h4>Recommendations:</h4>
                    <ul>
                        <li>Implement a whitelist of allowed redirect destinations</li>
                        <li>Use relative path redirects</li>
                        <li>Implement indirect reference maps for redirects</li>
                        <li>Validate and sanitize all redirect parameters</li>
                    </ul>
                </div>
            </div>
            {% endif %}
            
            <!-- Missing Headers Findings -->
            {% if results.missing_headers %}
            <div class="findings-section card">
                <h3><i class="fas fa-exclamation-triangle"></i> Missing Security Headers</h3>
                <div class="severity-indicator medium">Medium</div>
                
                <div class="finding-item">
                    <div class="finding-details">
                        <table class="headers-table">
                            <thead>
                                <tr>
                                    <th scope="col">Header</th>
                                    <th scope="col">Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for header, description in results.missing_headers.items() %}
                                <tr>
                                    <td class="code">{{ header }}</td>
                                    <td>{{ description }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h4>Recommendations:</h4>
                    <ul>
                        <li>Implement all missing security headers</li>
                        <li>Use a security header configuration tool or service</li>
                        <li>Regularly test your security headers using tools like SecurityHeaders.com</li>
                        <li>Keep up-to-date with new security headers and best practices</li>
                    </ul>
                </div>
            </div>
            {% endif %}
            
            {% if not results.sql_injection and not results.xss and not results.open_redirect and not results.missing_headers %}
            <div class="findings-section card">
                <h3><i class="fas fa-check-circle"></i> No Vulnerabilities Found</h3>
                <p>No vulnerabilities were detected during the scan. However, this does not guarantee that the website is completely secure. Consider performing additional security testing.</p>
            </div>
            {% endif %}
        </main>
        
        <footer>
            <p>&copy; 2025 WebVulnScan. All rights reserved.</p>
        </footer>
    </div>
    <script>
        // Optional JavaScript for additional functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add any JavaScript functionality here
        });
    </script>
    <style>
        /* Add any additional styles here */
        body {
            background-color: #f4f4f4;
            font-family: Arial, sans-serif;
        }
        .error-container {
            text-align: center;
            margin-top: 50px;
        }
        .error-icon {
            font-size: 50px;
            color: #e74c3c;
        }
        .btn.primary {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
        }
        .btn.primary:hover {
            background-color: #2980b9;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 10px;
            position: fixed;
            width: 100%;
            bottom: 0;
        }
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .results-actions {
            display: flex;
            gap: 10px;
        }
        .scan-summary, .vulnerability-summary, .findings-section {
            margin-bottom: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        .summary-item {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
        }
        .summary-item .label {
            font-weight: bold;
        }
        .summary-item .value {
            color: #333;
        }
        .vuln-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .vuln-stat {
            flex: 1;
            text-align: center;
            padding: 20px;
            border-radius: 5px;
            background-color: #f9f9f9;
            margin: 0 10px;
        }
        .vuln-stat.critical {
            background-color: #e74c3c;
            color: white;
        }
        .vuln-stat.high {
            background-color: #f39c12;
            color: white;
        }
        .vuln-stat.medium {
            background-color: #f1c40f;
            color: white;
        }
        .vuln-stat.low {
            background-color: #2ecc71;
            color: white;
        }
        .finding-item {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .finding-details {
            margin-bottom: 10px;
        }
        .finding-details .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .finding-details .detail-label {
            font-weight: bold;
        }
        .finding-details .detail-value {
            color: #333;
        }
        .finding-details .code {
            background-color: #eaeaea;
            padding: 5px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
        <script>
            // Optional JavaScript for additional functionality
            document.addEventListener('DOMContentLoaded', function() {
                // Add any JavaScript functionality here
            });
        </script>  
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
        <script src="static/js/script.js"></script>
        <script>
            // Optional JavaScript for additional functionality
            document.addEventListener('DOMContentLoaded', function() {
                // Add any JavaScript functionality here
            });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
        <script src="static/js/script.js"></script>
        <script>
            // Optional JavaScript for additional functionality
            document.addEventListener('DOMContentLoaded', function() {
                // Add any JavaScript functionality here
            });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
        <script src="static/js/script.js"></script>
        <script>
            // Optional JavaScript for additional functionality
            document.addEventListener('DOMContentLoaded', function() {
                // Add any JavaScript functionality here
            });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
        <script src="static/js/script.js"></script>
        <script>
            // Optional JavaScript for additional functionality
            document.addEventListener('DOMContentLoaded', function() {
                // Add any JavaScript functionality here
            });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
        <script src="static/js/script.js"></script>
        <script>
            // Optional JavaScript for additional functionality
            document.addEventListener('DOMContentLoaded', function() {
                // Add any JavaScript functionality here
            });
        </script>
</body>
</html>
